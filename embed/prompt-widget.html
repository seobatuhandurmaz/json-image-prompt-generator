<!-- Image Prompt Builder (no brand names) -->
<div id="prompt-builder" style="max-width:920px;margin:24px auto;font-family:system-ui,-apple-system,Segoe UI,Roboto">
  <style>
    :root{--bg:#fff;--fg:#111;--muted:#555;--border:#d7d7d7;--field-bg:#fff;--field-fg:#111;--brand:#22a316;}
    .card{background:var(--bg);color:var(--fg);padding:16px;border-radius:12px;border:1px solid var(--border)}
    .row{display:flex;gap:12px;margin:10px 0;flex-wrap:wrap}
    .row>input,.row>select,.row>textarea{flex:1;min-width:220px;padding:10px;border-radius:10px;border:1px solid var(--border);background:var(--field-bg);color:var(--field-fg)}
    .btn{background:var(--brand);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    pre{white-space:pre-wrap;background:#f6f8fa;color:#111;border:1px solid var(--border);padding:12px;border-radius:10px;overflow:auto}
    .tip{font-size:12px;color:var(--muted)}
    .palettes{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin:10px 0}
    .palette{border:1px solid var(--border);border-radius:10px;overflow:hidden;cursor:pointer;transition:transform .12s ease, box-shadow .12s ease;background:#fff}
    .palette:hover{transform:translateY(-1px);box-shadow:0 4px 18px rgba(0,0,0,.06)}
    .palette.selected{outline:2px solid var(--brand)}
    .sw{height:28px}.swrow{display:flex}.swrow .sw{flex:1}
    .clr{display:grid;grid-template-columns:120px 120px 1fr;gap:10px;align-items:center}
    .clr label{font-size:13px;color:var(--muted)} .alpha{accent-color:var(--brand)}
    .tag{font-size:12px;background:#eef7e9;color:#1f2937;border:1px solid #cfe9c7;border-radius:999px;padding:2px 8px}
  </style>

  <div class="card">
    <h3 style="margin:0 0 6px">Prompt Builder</h3>
    <div class="tip">Palet seçin veya renkleri ince ayarlayın; ardından “JSON Oluştur”a basın.</div>

    <div class="row">
      <input id="ratio" placeholder="Aspect Ratio (örn: 1024x440)" value="Aspect Ratio (örn: 1024x440)" />
      <input id="style" placeholder="Sanatsal Stil" value="Stil" />
    </div>
    <div class="row">
      <input id="theme" placeholder="Tema (ör: teenage, drama, list)" value="Tema (ör: teenage, drama, list)" />
    </div>

    <div class="row" style="margin-top:6px"><span class="tag">Palette</span></div>
    <div class="palettes" id="palGrid"></div>

    <div class="row" style="margin-top:6px"><span class="tag">Background</span></div>
    <div class="clr">
      <label>Renk</label>
      <input id="bgColor" type="color" value="#ffffff" />
      <div>
        <label>Alfa: <span id="bgAVal">1.00</span></label>
        <input id="bgAlpha" class="alpha" type="range" min="0" max="1" step="0.01" value="1" />
      </div>
    </div>

    <div class="row" style="margin-top:10px"><span class="tag">Primary Colors (3)</span></div>
    <div class="clr">
      <label>Color 1</label>
      <input id="c1" type="color" value="#eb7865" />
      <div><label>Alfa: <span id="a1Val">1.00</span></label><input id="a1" class="alpha" type="range" min="0" max="1" step="0.01" value="1" /></div>
    </div>
    <div class="clr">
      <label>Color 2</label>
      <input id="c2" type="color" value="#e94da1" />
      <div><label>Alfa: <span id="a2Val">1.00</span></label><input id="a2" class="alpha" type="range" min="0" max="1" step="0.01" value="1" /></div>
    </div>
    <div class="clr">
      <label>Color 3</label>
      <input id="c3" type="color" value="#121212" />
      <div><label>Alfa: <span id="a3Val">1.00</span></label><input id="a3" class="alpha" type="range" min="0" max="1" step="0.01" value="1" /></div>
    </div>

    <div class="row" style="margin-top:8px">
      <label style="display:flex;align-items:center;gap:8px"><input id="hasText" type="checkbox" checked/> Metin ekle</label>
      <input id="text" placeholder="Metin" value="Teen drama night"/>
      <input id="font" placeholder="Font Ailesi" value="Inter"/>
    </div>

    <div class="row"><span class="tag">Reference Image</span></div>
    <div class="row">
      <input id="ref" type="file" accept="image/*" />
      <span class="tip">Büyük görsellerde upload daha güvenli; JSON’a base64 gömülmez.</span>
    </div>

    <div class="row" style="margin-top:10px">
      <button class="btn" id="create">JSON Oluştur</button>
      <button class="btn" id="copy">Kopyala</button>
    </div>

    <pre id="out">{ "prompt": "Henüz oluşturulmadı" }</pre>
  </div>
</div>

<script>
(function(){
  // --- AYAR ---
  const API_URL = "https://json-image-prompt-generator-production.up.railway.app/generate"; // multipart endpoint

  // --- PALET VERİSİ ---
  const PRESETS = [
    { name:"Sunset Pop",  colors:["#eb7865","#e94da1","#121212"],  bg:"#ffffff" },
    { name:"Ocean Mist",  colors:["#76b5c5","#3e8e9f","#0b3c49"],  bg:"#ffffff" },
    { name:"Forest Glow", colors:["#9be15d","#00e3ae","#0c3b2e"],  bg:"#ffffff" },
    { name:"Royal Neon",  colors:["#7b5cff","#00e0ff","#001a3d"],  bg:"#ffffff" },
    { name:"Peach Cream", colors:["#ffd3b6","#ffaaa5","#a8e6cf"],  bg:"#ffffff" },
    { name:"Cyber Pink",  colors:["#ff77e9","#ff2e63","#252a34"],  bg:"#ffffff" },
    { name:"Sand Dune",   colors:["#e7d3a8","#b08968","#7f5539"],  bg:"#ffffff" },
    { name:"Slate Blue",  colors:["#93c5fd","#60a5fa","#1e3a8a"],  bg:"#ffffff" }
  ];

  // --- KISA SEÇİCİ ---
  const $ = (id)=>document.getElementById(id);

  // --- PALET GRID ---
  const grid = $("palGrid");
  PRESETS.forEach((p, i)=>{
    const el = document.createElement("div");
    el.className = "palette";
    el.title = p.name;
    const row = document.createElement("div"); row.className="swrow";
    p.colors.forEach(c=>{ const sw=document.createElement("div"); sw.className="sw"; sw.style.background=c; row.appendChild(sw); });
    el.appendChild(row);
    const bg = document.createElement("div"); bg.className="sw"; bg.style.background=p.bg; el.appendChild(bg);
    el.addEventListener("click", ()=>{
      $("c1").value=p.colors[0]; $("c2").value=p.colors[1]; $("c3").value=p.colors[2]; $("bgColor").value=p.bg;
      $("a1").value=$("a2").value=$("a3").value=$("bgAlpha").value="1"; updateAlphaLabels();
      [...grid.children].forEach(n=>n.classList.remove("selected")); el.classList.add("selected");
    });
    grid.appendChild(el);
  });
  // varsayılan
  grid.firstChild.classList.add("selected");

  function updateAlphaLabels(){
    $("bgAVal").textContent=(+$("bgAlpha").value).toFixed(2);
    $("a1Val").textContent=(+$("a1").value).toFixed(2);
    $("a2Val").textContent=(+$("a2").value).toFixed(2);
    $("a3Val").textContent=(+$("a3").value).toFixed(2);
  }
  ["bgAlpha","a1","a2","a3"].forEach(id=>$(id).addEventListener("input",updateAlphaLabels));
  updateAlphaLabels();

  // --- GÖNDER (MULTIPART) ---
  $("create").onclick = async () => {
    try {
      $("create").disabled = true; $("create").textContent = "Oluşturuluyor...";

      const payload = {
        aspectRatio: $("ratio").value,
        primaryColors: [
          {hex:$("c1").value, alpha:+$("a1").value},
          {hex:$("c2").value, alpha:+$("a2").value},
          {hex:$("c3").value, alpha:+$("a3").value}
        ],
        theme: "Özel",
        customTheme: $("theme").value,
        includeText: $("hasText").checked,
        text: $("text").value,
        fontFamily: $("font").value,
        backgroundColor: {hex:$("bgColor").value, alpha:+$("bgAlpha").value},
        style: $("style").value
      };

      const fd = new FormData();
      fd.append("json_data", JSON.stringify(payload));
      const file = $("ref").files?.[0];
      if (file) {
        // İSTEĞE BAĞLI: aşırı büyük dosyayı erkenden reddet (ör. > 8MB)
        if (file.size > 8 * 1024 * 1024) { 
          $("out").textContent = JSON.stringify({error:"Referans görsel 8MB'den büyük."}, null, 2);
          $("create").disabled=false; $("create").textContent="JSON Oluştur";
          return;
        }
        fd.append("reference_image", file, file.name);
      }

      const resp = await fetch(API_URL, { method: "POST", body: fd });
      const data = await resp.json();
      $("out").textContent = JSON.stringify(data, null, 2);
    } catch (e) {
      $("out").textContent = JSON.stringify({error:String(e)}, null, 2);
    } finally {
      $("create").disabled = false; $("create").textContent = "JSON Oluştur";
    }
  };

  $("copy").onclick = async () => {
    const txt = $("out").textContent || "";
    try { await navigator.clipboard.writeText(txt); $("copy").textContent="Kopyalandı!"; }
    catch(_) { $("copy").textContent="Kopyalanamadı"; }
    setTimeout(()=> $("copy").textContent="Kopyala", 1200);
  };
})();
</script>
